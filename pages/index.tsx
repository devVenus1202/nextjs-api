import React from 'react';
import Head from 'next/head';
import { GetStaticProps } from 'next';
import { useCallback, useEffect, useState } from 'react';
import { Input, Spinner, Text } from '@chakra-ui/react';
import debounce from 'lodash.debounce';

import client from "../apollo-client";
import InfoCard from '../components/InfoCard';
import { PAST_LAUNCHES } from '../graphql/queries';
import { Launch } from '../types/Launch';
import styles from '../styles/Home.module.css'
import { useQuery } from '@apollo/client';
import DataView from '../components/DataView';

// export const getStaticProps: GetStaticProps = async () => {
//   const { data } = await client.query({
//     query: pastLaunches
//   });
//   return {
//     props: {
//       pastLaunches: data.launchesPast,
//     },
//  };
// }
type PropsType = {
  initialPastLaunches: Array<Launch>
}

export default function Home({ initialPastLaunches }: PropsType) {
  const [searchKey, setSearchKey] = useState<string>('');
  const { loading, error, data } = useQuery(PAST_LAUNCHES, {
    variables: { missionName: searchKey },
  });

  // eslint-disable-next-line react-hooks/exhaustive-deps
  const debouncedChangeHandler = useCallback(debounce((e: React.ChangeEvent<HTMLInputElement>) => {
    setSearchKey(e.target.value)
  }, 500),[]);

  return (
    <div className={styles.container}>
      <Head>
        <title>witharchie test</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <main>
        <Input onChange={debouncedChangeHandler}/>
        {loading && <Spinner
          thickness='4px'
          speed='0.65s'
          emptyColor='gray.200'
          color='blue.500'
          size='xl'
        /> }
        {!loading && !error && <DataView data={data.launchesPast} />}
      </main>
    </div>
  )
}